<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
   <mapper namespace="com.oracle.S20220601.StoreRevMapper">
	 	<!-- 식당 리뷰  -->
	  	<select id="storeRevList" parameterType="int" resultType="review">
	  		SELECT * FROM review WHERE host_num = #{host_num}
	  	</select>
	  	<!-- 식당 리뷰 사진 -->
	  	<select id="storeRevPhoto" parameterType="Review" resultType="RevPhoto">
	  		SELECT * FROM revphoto WHERE host_num = #{host_num}
	  	</select>
	  	
	  	<!-- 식당 리뷰 삭제 -->
	  	<delete id="storeUserRevDel" parameterType="StoreReview">
	  			  		DELETE FROM review   WHERE ref      = #{rev_num} 
				  						     AND   host_num = #{host_num} 
	  	</delete>
	  	
	  	<!-- 식당 리뷰 갯수 -->
	  	<update id="storeRevcount" parameterType="int">
	  		UPDATE host SET rev_count = (SELECT COUNT(*) FROM review WHERE host_num = #{host_num} AND re_step = 0) WHERE host_num = #{host_num}
	  	</update>
	  	
	  	<!-- 식당 평점 	-->
	  	<update id="storeRevPointAvg" parameterType="int">
	  		UPDATE host SET host_avg = (SELECT (round(NVL(sum(rev_point)/COUNT(*),0),1)) FROM review WHERE host_num = #{host_num} AND re_step = 0) WHERE host_num = #{host_num}
	  	</update>
   </mapper>